var mtl_gtfsrt_map=L.map("leaflet-map").setView([45.5576,-73.7242],11.5);L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:18,id:"mapbox.streets",accessToken:"pk.eyJ1IjoiZmVsaXhpbngiLCJhIjoiY2lqYzJoMW9vMDA1dnZsa3F3cmZzcWVsciJ9.ZWBQm52vI7RFRwGuoAzwMg"}).addTo(mtl_gtfsrt_map);var posLayer=L.layerGroup().addTo(mtl_gtfsrt_map),transitLayer=L.layerGroup().addTo(mtl_gtfsrt_map);$(function(){var t,e,a,i,o;function r(t,e){var a=new Date(null);a.setSeconds(e),a.setHours(a.getHours()+1);var i=a.toLocaleTimeString();$(".ul-timestamp").append("<li>"+t+" - "+i+"</li>")}function n(t,e){$.get("geojson/"+t+".geojson",function(t){L.geoJSON(t,{style:function(){return{color:e}}}).addTo(transitLayer)})}console.log("Loading MTL-TRANSIT-TRACKER version 1.2.6..."),n("stm1","#00a54f"),n("stm2","#f58220"),n("stm4","#ffdc01"),n("stm5","#0072bc"),n("exo1","#f76179"),n("exo2","#a4cb92"),n("exo3","#989ec3"),n("exo4","#4fb7b4"),n("exo5","#cf5a94"),n("exo6","#f2a69a"),function(){exoTrips={};$.getJSON("https://felixinx.github.io/mtl-gtfs-rt/data/trips/exo-trains.json",function(t){exoTrips=t})}(),t=dataUrl,(e=$.get(t)).done(function(t){var e,a;t.results.forEach(function(t){var e=$.grep(exoTrips,function(e){return e.trip_id===t.trip_id},!1)[0];L.marker(L.latLng(t.lat,t.lon),{icon:icons[t.icon]}).addTo(posLayer).bindPopup(function(t,e){var a="<h3>";return a+=t.agency+" ",a+=t.vehicle_id+"</h3>",a+="<b>Trip: </b>"+t.trip_id+"<br>",a+="<b>Route: </b>"+t.route_id+"<br>",null!=e&&(a+="<b>Headsign: </b>"+e.trip_headsign+"<br>",a+="<b>Train number: </b>"+e.trip_short_name+"<br>"),null!=t.start_date&&(a+="<b>Start: </b>"+t.start_date+" "+t.start_time+"<br>",a+="<b>Current stop sequence: </b>"+t.current_stop_sequence+"<br>",a+="<b>Status: </b>"+t.current_status),a}(t,e))}),e=t.results,a=new Tabulator("#new-data-table",{height:5030,data:e,layout:"fitColumns",columns:[{title:"Agency",field:"agency",width:60},{title:"Vehicle number",field:"vehicle_id",headerFilter:"input",width:100},{title:"Route",field:"route_id",headerFilter:"input",width:60},{title:"Trip",field:"trip_id",headerFilter:"input",width:110},{title:"Start time",field:"start_time",width:85},{title:"Start date",field:"start_date",width:95},{title:"Current stop sequence",field:"current_stop_sequence",width:45,widthGrow:2},{title:"Current status",field:"current_status",width:140,widthGrow:2},{title:"Latitude",field:"lat",width:90},{title:"Longitude",field:"lon",width:100},{formatter:function(){return'<i class="fas fa-map-marked-alt"></i>'},width:50,widthGrow:1,align:"center",cellClick:function(t,e){var a,i;a=e.getRow().getData().lat,i=e.getRow().getData().lon,mtl_gtfsrt_map.setView([a,i],18),$("#mainTab li:first-child a").tab("show")}}],pagination:"local",paginationSize:100,groupBy:"agency"}),$("#download-csv").click(function(){a.download("csv","data.csv"),ga("send","event","DownloadButtons","DownloadCSV")}),r("STM Bus",t.time_stm),r("exo Trains",t.time_exo)}),e.fail(function(t,e){$("#offlineModal").modal()}),a=images,i=Math.floor(Math.random()*a.length),o="url(",o+=a[i].url,o+=") center center no-repeat",$(".main-bg").css("background",o),$(".main-bg").css("background-size","cover"),$(a[i].credit).appendTo(".credits"),mtl_gtfsrt_map.on("locationfound",function(t){L.marker(t.latlng).addTo(mtl_gtfsrt_map).bindPopup("You are near here!").openPopup()}),mtl_gtfsrt_map.locate({setView:!0,maxZoom:14}),$(".loading").css("display","none"),$("#leaflet-map").css("opacity","1")}),navigator;var icons={busSTMIcon:L.icon({iconUrl:"assets/map-bus-stm.svg",iconSize:[20,20]}),trainExoIcon:L.icon({iconUrl:" assets/map-train-exo.svg",iconSize:[20,20]})},timestampString=+new Date,dataUrl="https://v1.transittracker.ca/data/latest.json?time="+timestampString,images=[{url:"assets/images/wikimedia-30871-min.jpg",credit:"<p>Image from Wikimedia Commons by Alexcaban</p>"},{url:"assets/images/wikimedia-amt1356-min.jpg",credit:"<p>Image from Wikimedia Commons by Mtlfiredude</p>"}];
